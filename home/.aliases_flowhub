# POS
alias prodmeteordeploy="DEPLOY_HOSTNAME=galaxy.meteor.com meteor deploy pod10.pos.flowhub.co --settings deploy/prod_settings.env.json"
alias prodreportsmeteordeploy="DEPLOY_HOSTNAME=galaxy.meteor.com meteor deploy pos-reports.flowhub.co --settings deploy/reports_settings.env.json"

alias testingmeteordeploy="DEPLOY_HOSTNAME=galaxy.meteor.com meteor deploy flowhub.meteorapp.com --settings deploy/staging_settings.env.json"
alias meteordev="meteor --settings deploy/dev_settings.env.json"
alias meteortestapp="TEST_BROWSER_DRIVER=chrome TEST_WATCH=1 meteor test --full-app --driver-package meteortesting:mocha --port 4000 --settings deploy/test_settings.env.json"
alias chimpwatch="chimp --ddp=http://localhost:3000 --watch"
alias chimpwatchphantom="chimp --browser=phantomjs --ddp=http://localhost:3000 --watch"
alias chimpall="chimp --ddp=http://localhost:3000"
alias localprodrestore="mongorestore -h 127.0.0.1 --port 3001 -d meteor ~/Documents/pos-dev/dump/pos --drop"
# feed it a client
function restore_local_pos(){
  if [ $@ ]
  then
    echo "*************************"
    echo "restoring $@ locally"
    mongorestore -h 127.0.0.1 --port 3001 -d meteor dump/$@/meteor
    echo "*************************"
  else
    echo "*************************"
    echo "restoring pos locally"
    mongorestore -h 127.0.0.1 --port 27017 -d meteor dump/pos/meteor
    echo "*************************"
  fi
}

alias dump_pos_prod="mongodump -h backup-dev-shard-00-00-zsps0.mongodb.net:27017 -u As42DE7W8F -p G7hwpnHG2oXm4p --authenticationDatabase admin --db meteor --ssl"
function dump_client(){
  if [ $# -eq 0 ]
  then
      dump_pos_prod
  else
    clientIdArray=()
    for i in "$@"
    do
      clientIdArray+=("'$i',")
    done
    query="{clientId: {\$in: [${clientIdArray%?}]}}"
    users_query="{\$or: [{clientId: {\$in: [${clientIdArray%?}]}}, {roles: 'developer'}]}"
    app_collections=(clients customReports taxes regs stateRegs)
    client_collections=(locations locationSettings drawersActivities inventoryActivities priceProfileActivities strainActivities userActivities specialActivities roomActivities drawers priceProfiles specials rooms supplierActivities customerActivities productActivities loyaltyActivities customerGroupActivities customerSourcesActivities reportActivities suppliers customers customerGroups giftCards customerSources itemsInCart strains users shifts sales inventory products)
    for i in ${app_collections[@]}
    do
      dump_pos_prod --collection ${i} -o ./dump/multiClient
    done
    for i in ${client_collections[@]}
    do
      dump_pos_prod --collection ${i} --query $query -o ./dump/multiClient
    done
    dump_pos_prod --collection users --query $users_query -o ./dump/multiClient
  fi
}
